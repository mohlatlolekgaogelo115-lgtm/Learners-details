<!DOCTYPE html>
<html lang="en" class="scroll-smooth" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Student"Co" • Secure Dashboard</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { orbitron: ['Orbitron', 'sans-serif'], sans: ['Inter', 'sans-serif'] },
          colors: { 'neon-cyan': '#00d4ff', 'neon-purple': '#a855f7', 'ambient-dark': '#0a0e1a' }
        }
      }
    }
  </script>
</head>
<body class="min-h-screen bg-slate-50 dark:bg-ambient-dark text-slate-900 dark:text-slate-100 transition-all duration-300">

  <div class="fixed inset-0 pointer-events-none overflow-hidden opacity-30">
    <div class="absolute -top-1/4 -left-1/4 w-1/2 h-1/2 bg-neon-cyan rounded-full blur-[120px]"></div>
    <div class="absolute -bottom-1/4 -right-1/4 w-1/2 h-1/2 bg-neon-purple rounded-full blur-[120px]"></div>
  </div>

  <div id="authHub" class="relative min-h-screen flex items-center justify-center p-6">
    <div class="max-w-md w-full bg-white dark:bg-slate-900/50 backdrop-blur-xl border border-slate-200 dark:border-white/10 p-8 rounded-3xl shadow-2xl text-center">
      <h1 class="text-4xl font-orbitron font-bold bg-gradient-to-r from-neon-cyan to-neon-purple bg-clip-text text-transparent mb-2">Student"Co"</h1>
      <p class="text-slate-500 dark:text-slate-400 mb-8">Management Access Portal</p>

      <div class="space-y-6">
        <div id="googleSection" class="space-y-3">
          <label class="text-xs uppercase tracking-widest text-slate-400 font-bold">Step 1: Identity</label>
          <button id="googleSignInBtn" class="w-full flex items-center justify-center gap-3 bg-white hover:bg-slate-50 text-slate-800 font-semibold py-3 px-4 rounded-xl border border-slate-200 shadow-sm transition-all active:scale-95">
            <svg class="w-5 h-5" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.51h5.84c-.25 1.31-.98 2.42-2.07 3.16v2.63h3.35c1.96-1.81 3.09-4.47 3.09-7.25z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-1.01 7.28-2.73l-3.35-2.63c-1.01.68-2.29 1.08-3.93 1.08-3.02 0-5.58-2.04-6.49-4.79H.96v2.67C2.77 20.39 6.62 23 12 23z" fill="#34A853"/><path d="M5.51 14.21c-.23-.68-.36-1.41-.36-2.21s.13-1.53.36-2.21V7.34H.96C.35 8.85 0 10.39 0 12s.35 3.15.96 4.66l4.55-2.45z" fill="#FBBC05"/><path d="M12 4.98c1.64 0 3.11.56 4.27 1.66l3.19-3.19C17.46 1.01 14.97 0 12 0 6.62 0 2.77 2.61 0.96 6.34l4.55 2.45C6.42 6.02 8.98 4.98 12 4.98z" fill="#EA4335"/></svg>
            Continue with Google
          </button>
          <div id="googleSuccess" class="hidden text-green-500 text-sm font-medium flex items-center justify-center gap-2">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
            Signed in as <span id="signedInName"></span>
          </div>
        </div>

        <div class="border-t border-slate-100 dark:border-white/5 my-4"></div>

        <div id="passwordSection" class="space-y-3 opacity-50 pointer-events-none">
          <label class="text-xs uppercase tracking-widest text-slate-400 font-bold">Step 2: Authorization</label>
          <input type="password" id="mngPasswordInput" placeholder="Enter Management Key" 
            class="w-full px-4 py-3 rounded-xl bg-slate-100 dark:bg-slate-800 border-none focus:ring-2 focus:ring-neon-cyan text-center">
          <button id="unlockBtn" class="w-full bg-slate-800 dark:bg-neon-cyan text-white font-bold py-3 rounded-xl transition-all">
            Unlock Dashboard
          </button>
        </div>
      </div>
    </div>
  </div>

  <div id="mainDashboard" class="hidden relative min-h-screen px-4 py-12">
    <div class="max-w-6xl mx-auto">
      <div class="flex flex-col md:flex-row justify-between items-center mb-12 gap-6">
        <div>
          <h2 class="text-4xl font-orbitron font-bold text-neon-cyan">Learners Dashboard</h2>
          <p class="text-slate-500">Welcome back, <span id="dashUserName" class="text-neon-purple font-medium"></span></p>
        </div>
        <button id="logoutBtn" class="px-6 py-2 bg-red-500/10 text-red-500 border border-red-500/20 rounded-full hover:bg-red-500 hover:text-white transition-all">Sign Out</button>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
        <div class="bg-white dark:bg-slate-900 p-6 rounded-2xl border border-slate-200 dark:border-white/5 shadow-sm">
          <p class="text-slate-400 text-sm uppercase">Total Learners</p>
          <p id="totalStudents" class="text-4xl font-bold">0</p>
        </div>
        <div class="bg-white dark:bg-slate-900 p-6 rounded-2xl border border-slate-200 dark:border-white/5 shadow-sm">
          <p class="text-slate-400 text-sm uppercase">New Today</p>
          <p id="todayCount" class="text-4xl font-bold">0</p>
        </div>
        <div class="bg-white dark:bg-slate-900 p-6 rounded-2xl border border-slate-200 dark:border-white/5 shadow-sm">
          <p class="text-slate-400 text-sm uppercase">Latest ID</p>
          <p id="latestStudent" class="text-xl font-bold text-neon-purple truncate">—</p>
        </div>
      </div>

      <div class="bg-white dark:bg-slate-900 rounded-3xl border border-slate-200 dark:border-white/5 shadow-xl overflow-hidden">
        <div class="p-6 border-b border-slate-100 dark:border-white/5">
          <input id="searchInput" type="text" placeholder="Search students..." class="w-full max-w-md px-4 py-2 rounded-lg bg-slate-50 dark:bg-slate-800 border-none">
        </div>
        <div class="overflow-x-auto">
          <table class="w-full text-left">
            <thead class="bg-slate-50 dark:bg-slate-800/50 text-slate-400 text-xs uppercase">
              <tr>
                <th class="px-6 py-4">Student #</th>
                <th class="px-6 py-4">Name</th>
                <th class="px-6 py-4">ID Number</th>
                <th class="px-6 py-4 text-center">Manage</th>
              </tr>
            </thead>
            <tbody id="studentsTableBody" class="divide-y divide-slate-100 dark:divide-white/5"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
    import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCeJ-v25H3e8H6SOAJlhss81RO6aSPzhzk",
      authDomain: "student-co-45e92.firebaseapp.com",
      databaseURL: "https://student-co-45e92-default-rtdb.firebaseio.com",
      projectId: "student-co-45e92",
      storageBucket: "student-co-45e92.firebasestorage.app",
      messagingSenderId: "55508513562",
      appId: "1:55508513562:web:d38cc47b259ffecc9432a3",
      measurementId: "G-1VVHXLGPF6"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);
    const googleProvider = new GoogleAuthProvider();

    const MNG_PASSWORD = "STU2026";
    let googleVerified = false;

    // Elements
    const authHub = document.getElementById('authHub');
    const mainDashboard = document.getElementById('mainDashboard');
    const passwordSection = document.getElementById('passwordSection');
    const googleSignInBtn = document.getElementById('googleSignInBtn');
    const googleSuccess = document.getElementById('googleSuccess');
    const mngPasswordInput = document.getElementById('mngPasswordInput');
    const unlockBtn = document.getElementById('unlockBtn');

    // AUTH OBSERVER
    onAuthStateChanged(auth, (user) => {
      if (user) {
        googleVerified = true;
        googleSignInBtn.classList.add('hidden');
        googleSuccess.classList.remove('hidden');
        document.getElementById('signedInName').textContent = user.displayName;
        document.getElementById('dashUserName').textContent = user.displayName;
        passwordSection.classList.remove('opacity-50', 'pointer-events-none');
      } else {
        googleVerified = false;
        authHub.classList.remove('hidden');
        mainDashboard.classList.add('hidden');
        googleSignInBtn.classList.remove('hidden');
        googleSuccess.classList.add('hidden');
        passwordSection.classList.add('opacity-50', 'pointer-events-none');
        mngPasswordInput.value = "";
      }
    });

    // GOOGLE LOGIN
    googleSignInBtn.onclick = async () => {
      try { await signInWithPopup(auth, googleProvider); } 
      catch (e) { alert("Login failed: " + e.message); }
    };

    // PASSWORD UNLOCK
    unlockBtn.onclick = () => {
      if (mngPasswordInput.value === MNG_PASSWORD) {
        authHub.classList.add('hidden');
        mainDashboard.classList.remove('hidden');
        startListening();
      } else {
        alert("Invalid Management Key");
      }
    };

    document.getElementById('logoutBtn').onclick = () => signOut(auth);

    let allStudents = [];
    function startListening() {
      onValue(ref(db, 'students'), (snap) => {
        const data = snap.val() || {};
        allStudents = Object.entries(data).map(([key, v]) => ({ key, ...v }))
                        .sort((a,b) => b.key.localeCompare(a.key));
        render(allStudents);
      });
    }

    function render(list) {
      const tbody = document.getElementById('studentsTableBody');
      tbody.innerHTML = '';
      document.getElementById('totalStudents').textContent = list.length;
      
      list.forEach(s => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="px-6 py-4 font-bold text-neon-cyan">${s.key}</td>
          <td class="px-6 py-4">${s.name} ${s.surname}</td>
          <td class="px-6 py-4 text-slate-500">${s.idNumber}</td>
          <td class="px-6 py-4 text-center">
            <button onclick="confirmDelete('${s.key}')" class="text-red-500 hover:bg-red-50 rounded p-2 transition-all">Delete</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    window.confirmDelete = async (id) => {
        if(confirm(`Permanently delete ${id}?`)) {
            await remove(ref(db, `students/${id}`));
        }
    };
  </script>
</body>
</html>
