<!DOCTYPE html>
<html lang="en" class="scroll-smooth" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Student"Co" • Management Portal</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            orbitron: ['Orbitron', 'sans-serif'],
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
          colors: {
            'ambient-dark': '#0a0e1a',
            'neon-cyan': '#00d4ff',
            'neon-purple': '#a855f7',
          },
          boxShadow: {
            'glow-cyan': '0 0 20px rgba(0, 212, 255, 0.3)',
            'glass-dark': '0 10px 30px -10px rgba(0,0,0,0.6)',
          }
        }
      }
    }
  </script>
  <style>
    .glass-panel {
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
  </style>
</head>
<body class="min-h-screen font-sans antialiased bg-ambient-dark text-slate-200 transition-colors duration-300">

  <div class="fixed inset-0 pointer-events-none overflow-hidden">
    <div class="absolute -top-1/3 -left-1/4 w-3/4 h-3/4 bg-cyan-500/10 rounded-full blur-3xl animate-pulse"></div>
    <div class="absolute -bottom-1/3 -right-1/4 w-3/4 h-3/4 bg-purple-500/10 rounded-full blur-3xl animate-pulse delay-1000"></div>
  </div>

  <div id="loginScreen" class="fixed inset-0 z-50 flex items-center justify-center p-4">
    <div class="glass-panel p-8 md:p-12 rounded-[2.5rem] shadow-2xl max-w-md w-full text-center border-t border-white/20">
      <div class="w-20 h-20 bg-neon-cyan/10 rounded-3xl flex items-center justify-center mx-auto mb-6 rotate-3">
        <svg class="w-10 h-10 text-neon-cyan" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
        </svg>
      </div>
      <h1 class="text-3xl font-orbitron font-bold text-white mb-2">Student"Co"</h1>
      <p class="text-slate-400 mb-8 text-sm tracking-widest uppercase">Management Access</p>
      
      <div class="space-y-4">
        <input type="password" id="mngPasswordInput" placeholder="Enter Access Key" 
          class="w-full px-6 py-4 rounded-2xl bg-white/5 border border-white/10 focus:ring-2 focus:ring-neon-cyan focus:border-transparent outline-none text-center text-xl tracking-widest text-white placeholder:text-slate-600 transition-all">
        
        <button id="loginBtn" class="w-full bg-gradient-to-r from-neon-cyan to-neon-purple hover:scale-[1.02] text-white font-bold py-4 rounded-2xl transition-all shadow-glow-cyan active:scale-95">
          Unlock Dashboard
        </button>
      </div>
      <p class="mt-8 text-xs text-slate-600">Secure encrypted session • 2026 Admin</p>
    </div>
  </div>

  <div id="dashboardContent" class="hidden relative min-h-screen px-4 py-12">
    <div class="max-w-6xl mx-auto">
      
      <div class="flex flex-col md:flex-row justify-between items-center mb-12 gap-6">
        <div>
          <h2 class="text-4xl font-orbitron font-bold bg-gradient-to-r from-neon-cyan to-neon-purple bg-clip-text text-transparent">
            Learners Overview
          </h2>
          <p class="text-slate-400 mt-1">Management Portal • Student"Co"</p>
        </div>
        <button id="logoutBtn" class="px-6 py-2 rounded-full border border-red-500/30 text-red-400 hover:bg-red-500/10 transition-all text-sm font-medium">
          Lock Dashboard
        </button>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-10">
        <div class="glass-panel rounded-3xl p-8 border-l-4 border-l-neon-cyan">
          <p class="text-xs uppercase tracking-tighter text-slate-500 mb-2">Total Learners</p>
          <p id="totalStudents" class="text-6xl font-bold text-white">—</p>
        </div>
        <div class="glass-panel rounded-3xl p-8 border-l-4 border-l-neon-purple">
          <p class="text-xs uppercase tracking-tighter text-slate-500 mb-2">Newest Member</p>
          <p id="latestStudent" class="text-2xl font-medium text-white truncate">—</p>
        </div>
        <div class="glass-panel rounded-3xl p-8 border-l-4 border-l-neon-cyan">
          <p class="text-xs uppercase tracking-tighter text-slate-500 mb-2">Today's Entries</p>
          <p id="todayCount" class="text-6xl font-bold text-white">—</p>
        </div>
      </div>

      <div class="max-w-xl mx-auto mb-10 relative">
        <input id="searchInput" type="search" placeholder="Filter by Name, ID, or Phone..."
          class="w-full px-6 py-4 pl-14 glass-panel rounded-2xl text-lg focus:ring-2 focus:ring-neon-cyan/50 outline-none transition-all text-white">
        <svg class="absolute left-5 top-1/2 -translate-y-1/2 w-6 h-6 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
        </svg>
      </div>

      <div class="glass-panel rounded-[2rem] overflow-hidden shadow-2xl">
        <div class="overflow-x-auto">
          <table class="w-full text-left">
            <thead class="bg-white/5 text-slate-400 text-xs uppercase">
              <tr>
                <th class="px-8 py-5">UID</th>
                <th class="px-8 py-5">Student Name</th>
                <th class="px-8 py-5">ID Number</th>
                <th class="px-8 py-5">Contact</th>
                <th class="px-8 py-5 text-center">Manage</th>
              </tr>
            </thead>
            <tbody id="studentsTableBody" class="divide-y divide-white/5 text-slate-300">
              </tbody>
          </table>
        </div>
        <div id="emptyState" class="hidden py-32 text-center text-slate-500 font-orbitron">
          <p class="text-xl">Zero records found in database</p>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCeJ-v25H3e8H6SOAJlhss81RO6aSPzhzk",
      authDomain: "student-co-45e92.firebaseapp.com",
      databaseURL: "https://student-co-45e92-default-rtdb.firebaseio.com",
      projectId: "student-co-45e92",
      storageBucket: "student-co-45e92.firebasestorage.app",
      messagingSenderId: "55508513562",
      appId: "1:55508513562:web:d38cc47b259ffecc9432a3",
      measurementId: "G-1VVHXLGPF6"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const MASTER_KEY = "STU2026";
    const loginScreen = document.getElementById('loginScreen');
    const dashboardContent = document.getElementById('dashboardContent');
    const mngPasswordInput = document.getElementById('mngPasswordInput');
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');

    // 1. LOGIN LOGIC
    loginBtn.onclick = () => {
      if (mngPasswordInput.value === MASTER_KEY) {
        unlockApp();
      } else {
        alert("Invalid Management Key. Access Denied.");
        mngPasswordInput.value = "";
      }
    };

    // Support 'Enter' key
    mngPasswordInput.onkeypress = (e) => { if(e.key === 'Enter') loginBtn.click(); };

    function unlockApp() {
      loginScreen.classList.add('hidden');
      dashboardContent.classList.remove('hidden');
      startListeningToStudents();
    }

    logoutBtn.onclick = () => location.reload();

    // 2. DATA LOGIC
    let allStudents = [];

    function startListeningToStudents() {
      onValue(ref(db, 'students'), (snapshot) => {
        const data = snapshot.val();
        if (!data) {
          allStudents = [];
          renderStudents([]);
          updateStats(0, 0, '—');
          return;
        }
        allStudents = Object.entries(data).map(([key, value]) => ({ key, ...value }))
                        .sort((a,b) => b.key.localeCompare(a.key));
        
        const today = new Date().toISOString().split('T')[0];
        const todayCount = allStudents.filter(s => s.createdAt && s.createdAt.startsWith(today)).length;
        updateStats(allStudents.length, todayCount, allStudents[0]?.key);
        renderStudents(allStudents);
      });
    }

    function updateStats(total, today, latest) {
      document.getElementById('totalStudents').textContent = total;
      document.getElementById('todayCount').textContent = today;
      document.getElementById('latestStudent').textContent = latest || '—';
    }

    function renderStudents(students) {
      const tbody = document.getElementById('studentsTableBody');
      tbody.innerHTML = '';
      document.getElementById('emptyState').classList.toggle('hidden', students.length > 0);

      students.forEach(student => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-white/5 transition-colors group';
        tr.innerHTML = `
          <td class="px-8 py-5 font-mono text-neon-cyan text-sm">${student.key}</td>
          <td class="px-8 py-5 text-white font-medium">${student.name || ''} ${student.surname || ''}</td>
          <td class="px-8 py-5 text-slate-500">${student.idNumber || '—'}</td>
          <td class="px-8 py-5 text-slate-500 text-sm">${student.cellNumber || '—'}</td>
          <td class="px-8 py-5 text-center">
            <button class="delete-btn px-4 py-2 bg-red-500/10 hover:bg-red-500 text-red-500 hover:text-white rounded-xl text-xs font-bold transition-all opacity-0 group-hover:opacity-100"
              data-id="${student.key}">DELETE</button>
          </td>
        `;
        tbody.appendChild(tr);
      });

      // DELETE HANDLER (Double Check)
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.onclick = async () => {
          const id = btn.dataset.id;
          if (confirm(`CRITICAL: Confirm permanent deletion of ID ${id}?`)) {
            await remove(ref(db, `students/${id}`));
          }
        };
      });
    }

    // SEARCH FILTER
    document.getElementById('searchInput').oninput = (e) => {
      const term = e.target.value.toLowerCase();
      const filtered = allStudents.filter(s => 
        Object.values(s).some(val => String(val).toLowerCase().includes(term))
      );
      renderStudents(filtered);
    };
  </script>
</body>
</html>
